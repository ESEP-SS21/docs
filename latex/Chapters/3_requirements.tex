\chapter{Requirements und Use Cases}\label{ch:requirements-und-use-cases}

\section{Systemebene}\label{sec:systemebene}

%% Die Anforderungen aus der Aufgabenstellung sind nicht vollständig. Die Struktur der nachfolgenden Kapitel soll Sie bei der Strukturierung der Analyse unterstützen. Dokumentieren Sie die Ergebnisse der Analysen entsprechend.

\subsection{Stakeholder}\label{subsec:stakeholder}

%% Ermitteln Sie die Stakeholder für das Projekt und listen Sie diese hier auf.

\paragraph{Externe Stakeholder}
\begin{itemize}
    \item Auftraggeber
    \begin{itemize}
        \item Erfüllung aller spezifizierten Anforderungen
        \item Pünktliche Lieferung zum vorgegebenen Termin
        \item Verwendung der vorgegebenen Hard- und Software
    \end{itemize}
    \item Betreuer
    \begin{itemize}
        \item Erreichen der Ziele am Ende jeder Phase
        \item Vollständige Dokumentation als Rückmeldungsgrundlage
    \end{itemize}
    \item Benutzer
    \begin{itemize}
        \item System stellt keine Gefahr dar
        \item Information über Fehlerzustände
        \item Seltenes Eingreifen erforderlich
        \item Hoher \gls{durchsatz}
        \item Einfache Bedienung und Inbetriebnahme (Dokumentation)
    \end{itemize}
    \item Verwaltung TI-Labor
    \begin{itemize}
        \item Keine Beschädigung der \glspl{anlage}
    \end{itemize}
\end{itemize}

\paragraph{Interne Stakeholder}
\begin{itemize}
    \item Entwickler
    \begin{itemize}
        \item Gute Testbarkeit
        \item Einfache Erweiterbarkeit und Modularität
        \item Einheitliche Schnittstellen und Benennungen
        \item Dokumentation (im Code) für Fehlersuche und Teamarbeit
    \end{itemize}
\end{itemize}

\paragraph{Akteure}

\begin{itemize}
    \item \Gls{ctrlp}\\
    Es stellt den \gls{t_start}, \gls{t_stop} und \gls{t_reset} der\gls{anlage} zur Verfügung.

    \item \Gls{belt}\\
    Auf dem \gls{belt} werden \Glspl{workpiece} durch die \Gls{anlage} bewegt.
    \item FTS\_2\\
    Die jeweils andere \gls{anlage} des Systems.
    \item E\_Stop\\
    Ein Button zum Auslösen des Emergency-Stops. Ist er gedrückt, kann er durch Herausziehen
    und drücken des \gls{t_reset} deaktiviert werden.
    \item Metal\_Detector\\
    Sensor zum Erfassen von Metall eines \Gls{workpiece}es.
    \item Height\_Measurement\\
    \gls{lb_he} zum Erfassen der Höhe eines \Gls{workpiece}es.
    \item Stoplight\\
    \gls{ampelled}, die durch verschiedene LED-Einstellungen Zustandsinformationen der \gls{anlage} anzeigt.
    \item Sorting\_Mechanism\\
    Jede \gls{anlage} besitzt einen \Gls{sortierer}.
    Dieser ist in einer von zwei Varianten eingebaut:
    \begin{itemize}
        \item Ejector\\
        Der \gls{ejector}, der bei Stromzufluss ausfährt und so \Glspl{workpiece} in die \gls{rampe} stoßen soll.
        Ohne Strom steht der \gls{ejector} auf \gls{do_not_discard}.
        \item Switch\\
        Die \gls{weiche}, die bei Stromzufluss auf \gls{do_not_discard} steht und \Glspl{workpiece} durchlässt.
        Ohne Strom steht die  \gls{weiche} auf \gls{discard} und befördert \Glspl{workpiece}
        langsam in die \gls{rampe}.
    \end{itemize}
    \item LightBarrier\\
    Das System besitzt diverse Lichtschranken. Sie werden als Trigger und zur Steuerung
    des Kontrollflusses benutzt:
    \begin{itemize}
        \item \gls{lb_st}\\
        Lichtschranke am Anfang eines \gls{belt}es.
        Die Unterbrechung dieser Lichtschranke setzt, vorausgesetzt es liegen keine
        Fehler vor, das \gls{belt} in Bewegung.
        \item \gls{lb_ra}\\
        Lichtschranke an der \gls{rampe}. Aussortierte \Glspl{workpiece} passieren diese Lichtschranke.
        Die Unterbrechung dieser Lichtschranke kann als erfolgreiche Aussortierung interpretiert werden.
        Eine dauerhafte Unterbrechung signalisiert eine volle \gls{rampe}.
        \item \gls{lb_he}\\
        Lichtschranke an der Position des Höhensensors.
        Sie wird als Trigger für den Start der Höhenmessung benutzt.
        \item \gls{lb_sw}\\
        \gls{lb_sw} vor dem \Gls{sortierer} der \gls{anlage}.
        Die Unterbrechung startet die Aussortierung des \gls{workpiece}es, vorrausgesetzt es ist mit \gls{discard} markiert.
        \item \gls{lb_en}\\
        Lichtschranke am Ende eines \gls{belt}es.
        Die Unterbrechung dieser Lichtschranke kann das Transferieren des \Gls{workpiece}es an die nächste \gls{anlage} einleiten.
        Am Ende der zweiten \gls{anlage} werden bei Unterbrechung der \gls{lb_en} \Gls{workpiece}-Informationen an der Konsole ausgegeben.
    \end{itemize}
\end{itemize}

\subsection{Anforderungen}\label{subsec:anforderungen2}
Im Folgenden werden die Anforderungen an das System definiert. Diese wurden zur besseren
Übersichtlichkeit kategorisiert. Zum besseren Abgleich wird in den
Anforderungen jeweils auf die Sätze in den Anforderungen des Kunden verwiesen, aus denen diese hervorgehen.
Das wird, wie folgendes Beispiel zeigt, gekennzeichnet: (36). 

\input{Chapters/3_x_gitlab_reqs.tex}
\FloatBarrier

%% In der Aufgabenstellung sind Anforderungen an das System gestellt.
%% Arbeiten Sie diese hier auf und ergänzen Sie diese entsprechend der Absprachen mit dem Betreuer.
%% Achten Sie auf die entsprechende Atribuierung.
%% Berücksichtigen Sie auch mögliche Fehlbedienungen und Fehlverhalten des Systems.

\subsection{Systemkontext}\label{subsec:systemkontext2}

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{../out/diagrams/stage1/systemkontext.pdf}
    \caption{Systemkontext}
    \label{fig:systemkontext}
\end{figure}


Betrachte Abbildung \ref{fig:systemkontext}.
Die Systemsicht bringt umliegende Aktorik des Systems und System selber miteinander in Beziehung.

%% Use Cases werden aus einer bestimmten Sicht erstellt.
%% Dokumentieren Sie diese mittels Kontextdiagramm oder Use Case Diagramm.
%% Die Use Cases und Test Cases müssen zu der hier verwendeten Nomenklatur konsistent sein.

\subsection{Use Cases / User Stories}\label{subsec:use-cases-user-stories}

In Abbildung~\ref{fig:ucd} sind die Use Cases in einem Use Case Diagramm dargestellt.
Die Farbgebung dient lediglich zur Veranschaulichung.

\begin{figure}[h]
    \centering
    \makebox[\textwidth][c]{\includegraphics[width=1.2\textwidth]{../out/diagrams/stage1/ucd}}
    \caption{Use Case Diagramm}
    \label{fig:ucd}
\end{figure}

%% Dokumentieren Sie hier, welche Use Cases/ User Stories Sie auf der Systemebene implementieren müssen.
%% Die Test Cases sollen später zu den Use Cases/ User Stories konsistent sein.

%% < Hier kommt die genaue Beschreibung der Use.
%% Pro Anforderung eine Tabelle benutzen. Die Tabelle nach Belieben vervielfältigen. >


\input{Chapters/UseCases/uc02}

\input{Chapters/UseCases/uc03}

\input{Chapters/UseCases/uc04}

\input{Chapters/UseCases/uc05}

\input{Chapters/UseCases/uc06}

\input{Chapters/UseCases/uc07}

\input{Chapters/UseCases/uc08}

\input{Chapters/UseCases/uc09}

\input{Chapters/UseCases/uc10}

\input{Chapters/UseCases/uc11}

\input{Chapters/UseCases/uc12}

\input{Chapters/UseCases/uc14}

\input{Chapters/UseCases/uc15}

\input{Chapters/UseCases/uc16}

\input{Chapters/UseCases/uc17}




\section{Systemanalyse}\label{sec:systemanalyse}

%% Ihr technisches System hat aus Sicht der Software bestimmte Eigenschaften.
%% Was muss man für die Entwicklung der Software in Struktur, Schnittstellen,
%% Verhalten und an Besonderheiten wissen?
%% Wählen Sie eine Kapitelstruktur, die am besten zur Dokumentation Ihrer Ergebnisse geeignet ist.

\subsection{Art des Systems}

Bei dem zu entwerfenden System handelt es sich um die Steuerung eines Festo-Transfersystems,
welche auf dem BeagleBoneBlack Einplatinencomputer, von dem jede \gls{anlage} einen besitzt, zu realisieren ist.
Daher handelt es sich um ein Embedded System.
Für das zu entwickelnde Softwaresystem bedeutet dies, dass es zur Steuerung der Prozesse sehr nah
an der in der \gls{anlage} verbauten Hardware arbeiten muss.
Ein weiterer wichtiger Punkt ist, dass das System mit einer weiteren gleichartigen \gls{anlage} über
das Netzwerk kommunizieren muss. Dies ist ebenfalls im Entwurfsprozess zu berücksichtigen.

\subsubsection{Eigenschaften des BeagleBoneBlack und Grundlagen QNX}

Auf dem BeagleBoneBlack Einplatinencomputer läuft das Echtzeitbetriebssystem QNX, das Kommunikation
zwischen Prozessen und Threads mittels Message Passing bevorzugt.
Dieses Message Passing kann auch über das Netzwerk erfolgen, sodass Messages auch an
einen weiteren BeagleBoneBlack geschickt werden können.
Die Architektur sollte sich daher auf Message-Passing stützen, gerade um die Kommunikation mit der
anderen gleichartigen \gls{anlage} zu erleichtern.
Da der BeagleBoneBlack ein eigenes Stück Hardware mit eigenem Betriebssystem ist, muss für die
Entwicklung die Entwicklungsumgebung QNX Momentics benutzt werden, die Debugging und Testing ermöglicht.
Die Kommunikation mit dem BeagleBoneBlack und dem Entwicklungsrechner erfolgt über die Netzwerkverbindung.

\subsection{Kommunikation mit der Hardware}

Die Ansteuerung der Aktorik und Sensorik der \gls{anlage} erfolgt direkt über die GPIOs des BeagleBoneBlack.
Die Sensorik ist hierbei an GPIO0, die Aktorik des Transfersystems an GPIO1 und die LEDs des \gls{ctrlp}s an GPIO2
gekoppelt.
Bei den GPIOs können Bits einzeln gesetzt und gelöscht werden und es können die aktuellen Werte ausgelesen werden.
Auf Veränderung an den GPIOs kann mittels pro Pin konfigurierbarer Interrupts (steigende Flanke, fallende Flanke,
Level=0, Level=1) reagiert werden.
Interrupts lassen sich nach dem Auslösen für einen einstellbare Zeit ignorieren (Debouncing).
Um später nicht direkt mit den GPIOs interagieren zu müssen, sollte ein Hardware Abstraction Layer
einfachere Schnittstellen zum Ansteuern der Aktorik und für das Reagieren auf die Sensorik bereitstellen.
Der Höhensensor ist am ADC des BeagleBoneBlack angeschlossen. Dieser kann über das Schreiben in ein
bestimmtes GPIO-Register aktiviert werden und kann dann nach erfolgreicher Messung einen Interrupt auslösen.

\subsection{Besonderheiten beim Systemaufbau}

Bei genauerer Betrachtung des Systemaufbaus fallen folgende Eigenschaften und Zusammenhänge besonders auf.
Sie sind bei der Verhaltensmodellierung zu berücksichtigen und könnten das Erkennen von Szenarien vereinfachen.

\subsubsection{Platzierung der \gls{lb_he} bei der Höhenmessung}

Die \gls{lb_he} an der Höhenmessung ist so platziert, dass sich die Mitte eines \Gls{workpiece}es bei ihrer
Unterbrechung genau unter dem Höhenmesser befindet.
Auf diese Art lassen sich die unterschiedlichen Höhen von \Glspl{workpiece}n mittels einer einzelnen Messung unterscheiden.
Die gemessenen Höhen bei unterschiedlichen \glspl{workpiece_type} gehen aus Tabelle~\ref{tab:werkstuecke} hervor.

\begin{table}[h]
    \begin{center}
        \begin{tabular}{ |c|c| }
            \hline
            Form                     & Höhe in mm \\
            \hline\hline
            HOCH                 &  25,0-25,4\\
            \hline
            FLACH                     & 19,8-20,2 \\
            \hline
            LOCH               & 15,8-16,4 \\
            \hline
        \end{tabular}
    \end{center}
    \caption{Höhen der unterschiedlichen \glspl{workpiece_type}}
    \label{tab:werkstuecke}
\end{table}

Ebenso fällt auf, dass der Abstand der \gls{lb_he} für die Höhenmessung vom Anfang des Förderbands ca. 25 cm beträgt,
was für die Bestimmung des Abstands bei der Werkstückübergabe zwischen zwei \glspl{anlage} wichtig ist.

\subsubsection{Der Aufbau im Bereich des \gls{sortierer}s}

Im Transportweg der \Glspl{workpiece} befindet sich an der Stelle, an der ein \Gls{workpiece} vom \gls{sortierer} aussortiert
werden muss, eine Lichtschranke.
Das Unterbrechen dieser Lichtschranke kann daher als Signal zum Starten des Aussortiervorgangs verstanden werden.
Im Falle einer \gls{weiche} als \gls{sortierer} müsste diese auf \gls{do_not_discard} gesetzt werden, falls keine Aussortierung erfolgen soll.
Im Falle eines \Gls{ejector}s müsste dieser auf \gls{discard} gesetzt werden, falls das \Gls{workpiece} aussortiert werden muss.
Oberhalb des \Gls{workpiece}es befindet sich in dieser Position auch der Metallsensor.
Bei einer \gls{anlage} mit \gls{weiche} ist wichtig, dass diese bei längerem Verharren von \gls{do_not_discard} beschädigt werden kann.

\section{Softwareebene}\label{sec:softwareebene}

%% Sie sollen Software für die Steuerung des technischen Systems erstellen.
%% Aus den Anforderungen auf der Systemebene und der Systemanalyse ergeben sich
%% Anforderungen für Ihre Software.
%% Insbesondere wird sich die Software der beiden Anlagenteile in einigen Punkten unterscheiden.
%% Dokumentieren Sie hier die Anforderungen, die sich speziell für die Software ergeben haben.

\subsection{Systemkontext}\label{subsec:systemkontext}

%% Wie sieht der Kontext Ihrer Software aus? Wie erfolgt die Kommunikation mit Nachbarsystemen?
%% Liste der ein- und ausgehenden Signale/Nachrichten.

\subsection{Anforderungen}\label{subsec:anforderungen}

%% Welche wesentlichen Anforderungen ergeben sich aus den Systemanforderungen für Ihre Software?
%% Berücksichtigen Sie auch mögliche Fehlbedienungen und Fehlverhalten des Systems.
