\chapter{Design}\label{ch:design}

%% Anmerkung: Die Implementierung MUSS zu Ihrem Design-Modell konsistent sein.
%% Strukturen, Verhalten und Bezeichner im Code müssen mit dem Modell übereinstimmen.
%% Daher ist ein wohlüberlegtes Design wichtig.


\section{Systemarchitektur}\label{sec:systemarchitektur}

%% Erstellen Sie eine Architektur für Ihre Software.
%% Geben Sie eine kurze Beschreibung Ihrer Architektur mit den dazugehörenden Komponenten
%% und Schnittstellen an.
%% Dokumentieren Sie hier wichtige technische Entscheidungen.
%% Welche Pattern werden gegebenenfalls verwendet? Wie erfolgt die interne Kommunikation?

In Abbildung~\ref{fig:cmp} ist die Systemarchitektur mithilfe eines UML Komponentendiagramms
visualisiert.

\begin{figure}[h]
    \centering
    \makebox[\textwidth][c]{\includegraphics[width=1.2\textwidth]{../out/diagrams/stage1/cmp}}
    \caption{Komponentendiagramm}
    \label{fig:cmp}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage2/cd_hal}}
    \caption{Klassendiagramm HAL}
    \label{fig:cd-hal}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage3/cd_hal_sens}}
    \caption{}
    \label{fig:cd-hal-sens}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage3/cd_dispatcher}}
    \caption{Klassendiagramm Dispatcher}
    \label{fig:cd-dispatcher}
\end{figure}


\section{Datenmodellierung}\label{sec:datenmodellierung}

%% Bestimmen Sie das Datenmodell und dokumentieren Sie es hier mit Hilfe von UML Klassendiagrammen
%% unter Beachtung der Designprinzipien. Die Modelle können mit Hilfe eines UML-Tools erstellt werden.
%% Hier ist dann ein Übersichtsbild einzufügen.
%% Geben Sie eine kurze textuelle Beschreibung des Datenmodells
%% und deren wichtigsten Klassen und Methoden an.


\section{Verhaltensmodellierung}\label{sec:verhaltensmodellierung}

\subsection{Beschreibung des Servicemode}

Die detaillierte Durchführung des Servicemode ist in untenstehende Schritte unterteilt. Dabei ist mit der Quittierung
durch den Benutzer das Drücken des \gls{t_reset}s am \gls{ctrlp} gemeint.
\begin{enumerate}

    \item[1)] System schaltet \gls{ampelled} auf schnell grün blinkend
    \item[2)] Kalibrierung des \gls{lb_he}
    \begin{itemize}
        \item Der \gls{lb_he} wird kalibriert
        \item LED am \gls{t_reset} wird aktiviert
        \item Benutzer quittiert Kalibrierung der \gls{lb_he}
        \item LED am \gls{t_reset} wird deaktiviert
    \end{itemize}
    \item[3)] Testen des \gls{belt}s
    \begin{itemize}
        \item \Gls{belt} fährt für eine Sekunde schnell vorwärts
        \item \Gls{belt} fährt für eine Sekunde schnell rückwärts
        \item \Gls{belt} stoppt
        \item LED am \gls{t_reset} wird aktiviert
        \item Benutzer quittiert korrekte Funktionsweise des \gls{belt}s
        \item LED am \gls{t_reset} wird deaktiviert
    \end{itemize}
    \item[4)] Testen des \gls{sortierer}s
    \begin{enumerate}
        \item[4a)] \Gls{sortierer} ist \gls{weiche}
        \begin{itemize}
            \item \gls{weiche} wird für zwei Sekunden auf \gls{do_not_discard} gesetzt
            \item \gls{weiche} wird auf \gls{discard} gesetzt
            \item LED am \gls{t_reset} wird aktiviert
            \item Benutzer quittiert korrekte Funktionsweise der \gls{weiche}
            \item LED am \gls{t_reset} wird deaktiviert
        \end{itemize}
        \item[4b)] \gls{sortierer} ist \gls{ejector}
        \begin{itemize}
            \item \Gls{ejector} wird aktiviert
            \item LED am \gls{t_reset} wird aktiviert
            \item Benutzer quittiert korrekte Funktionsweise des \gls{ejector}s
            \item LED am \gls{t_reset} wird deaktiviert
        \end{itemize}
    \end{enumerate}
    \item[]

\end{enumerate}


\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[height=0.93\textheight]{../out/diagrams/stage3/stm_top_level}}
    \caption{Der Einstiegspunkt einer \gls{anlage}.
    Verwaltet die Betriebszustände und Sub-State Machines}
    \label{fig:stm_top_level}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage3/stm_error}}
    \caption{Umgang mit Fehlern und Anzeige derer mithilfe der \gls{ampel}}
    \label{fig:stm_error}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage3/stm_werkstueck_annahme}}
    \caption{Die Annahme eines \glspl{workpiece}s am Anfang der \gls{anlage}}
    \label{fig:stm_werkstueck_annahme}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage3/stm_hoehe_messen}}
    \caption{Messung der Höhe eines \glspl{workpiece}s}
    \label{fig:stm_hoehe_messen}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage3/stm_werkstueck_sortieren}}
    \caption{Sortierung von \glspl{workpiece}n}
    \label{fig:stm_werkstueck_sortieren}
\end{figure}

\begin{figure}
    \makebox[\textwidth][c]{\includegraphics[width=1.25\textwidth]{../out/diagrams/stage3/stm_werkstueck_transfer}}
    \caption{Transfer eines \glspl{workpiece}s an die nächste \gls{anlage}}
    \label{fig:stm_werkstueck_transfer}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale = 0.5]{../out/diagrams/stage3/stm_werkstueck_transfer_req_antworten}
    \caption{Antworten eines Transfer-Request der vorherigen \gls{anlage}.
    Ein Transfer-Request wird in stm Workpiece Transfer (Abbildung~\ref{fig:stm_werkstueck_transfer}) gesendet}
    \label{fig:stm_werkstueck_transfer_req_antworten}
\end{figure}


%% Ihre Software muss zur Bearbeitung der Aufgaben ein Verhalten aufweisen.
%% Überlegen Sie sich dieses Verhalten auf Basis der Anforderungen und modellieren
%% Sie das Verhalten unter Verwendung von Verhaltensdiagrammen aus den Vorlesungen.

